<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
</head>

<body>
    <header class="container"></header>
    <h1>Weather Dashboard</h1>
    
    <!-- form for user to search city -->
    <form id="searchForm">
        <h2>Search For a City</h2>
        <input type="text" id="cityInput" placeholder="Enter city name" required>
        <input type="text" id="stateInput" placeholder="Enter state " required>
        <button id="btnWeather" class="btn btn-success">Get Weather</button>

        <!-- <button type="submit">Search</button> -->
    </form>

    <div id="result"></div>

    <script>
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const cityName = document.getElementById('cityInput').value;
            getCoordinates(cityName);
        });

        function getCoordinates(cityName) {

         const apiUrl = `https://api.openweathermap.org/data/3.0/onecall?lat={lat}&lon={lon}&exclude={part}&appid=f323762659d7f689219c2c868b844fc0`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        const latitude = data[0].lat;
                        const longitude = data[0].lon;
                        displayCoordinates(latitude, longitude);
                    } else {
                        displayError('Could not find coordinates for the provided city.');
                    }
                })
                .catch(error => displayError(`Error fetching data: ${error}`));
        }

        function displayCoordinates(latitude, longitude) {
            document.getElementById('result').innerHTML = `Latitude: ${latitude}, Longitude: ${longitude}`;
        }

        function displayError(message) {
            document.getElementById('result').innerHTML = `
            <p style="color: red;">${message}</p>`;
        }

        // get city and state from user
        var txtCity = document.getElementById("cityInput");
        var txtState = document.getElementById("stateInput");

        // get weather button
        var btnWeather = document.getElementById("btnWeather");
        btnWeather.addEventListener("click", getWeather);
     
        if (btnWeather) {
            btnWeather.addEventListener("click", getWeather);
        }


        // returns geolocation based on city name and api key
        function getWeather() {
            var apiKey = "f323762659d7f689219c2c868b844fc0";
            var city = txtCity.value;
            var state = txtState.value;

            // Using fetch to get the longitude and latitude.
            fetch('http://api.openweathermap.org/geo/1.0/direct?q=' + city + ',' + state + ',840&limit=1&appid=' + apiKey)
                .then(response => response.json())
                .then(answer => {
                    for (let i = 0; i < answer.length; i++) {
                        console.log("lat = " + answer[i].lat + ", longitude is: " + answer[i].lon);
                    }
                })
        }
    </script>


     </script src="./fakescript/script.js"></script>
    
</body>
</html>
